#!/usr/bin/env node
import mri from 'mri';
import { resolve } from 'pathe';
import { d as createNitro, e as createDevServer, p as prepare, b as build, c as copyPublicAssets, a as prerender } from './chunks/dev.mjs';
import 'consola';
import 'rollup';
import 'fs-extra';
import 'fs';
import 'globby';
import 'pretty-bytes';
import 'gzip-size';
import 'chalk';
import 'std-env';
import 'module';
import 'defu';
import 'rollup-plugin-terser';
import '@rollup/plugin-commonjs';
import '@rollup/plugin-node-resolve';
import '@rollup/plugin-alias';
import '@rollup/plugin-json';
import '@rollup/plugin-replace';
import '@rollup/plugin-virtual';
import '@rollup/plugin-wasm';
import '@rollup/plugin-inject';
import 'rollup-plugin-visualizer';
import 'unenv';
import 'mlly';
import 'jiti';
import 'dot-prop';
import 'url';
import '@vercel/nft';
import 'etag';
import 'mime';
import 'hasha';
import 'table';
import 'is-primitive';
import 'esbuild';
import '@rollup/pluginutils';
import 'ufo';
import 'chokidar';
import 'hookable';
import 'c12';
import 'archiver';
import 'pkg-types';
import 'worker_threads';
import 'p-debounce';
import 'h3';
import 'http-proxy';
import 'listhen';
import 'serve-static';
import 'connect';

async function main() {
  const args = mri(process.argv.slice(2));
  const command = args._[0];
  const rootDir = resolve(args._[1] || ".");
  if (command === "dev") {
    const nitro = await createNitro({
      rootDir,
      dev: true,
      preset: "dev"
    });
    const server = createDevServer(nitro);
    await server.listen({});
    await prepare(nitro);
    await build(nitro);
    return;
  }
  if (command === "build") {
    const nitro = await createNitro({
      rootDir,
      dev: false
    });
    await prepare(nitro);
    await copyPublicAssets(nitro);
    await build(nitro);
    await prerender(nitro);
    process.exit(0);
  }
  console.error(`Unknown command ${command}! Usage: nitro dev|build [rootDir]`);
  process.exit(1);
}
main().catch((err) => {
  console.error(err);
  process.exit(1);
});
